---
title: "Introduction to spectrolab"
author: "Jose Eduardo Meireles, Anna K. Schweiger"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to spectrolab}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The goal of `spectrolab` is to provides essential functions to process data from portable spectrometers and a common interface for spectra that other packages can build on. Currently `spectrolab` has been only tested for SVC data (Spectral Vista Inc.). `spectrolab` provides methods to read spectral data files, to perform jump correction, vector normalisation, smoothing at the sensor overlap regions, and to filter out bad measurements. `spectrolab` introduces the S3 class `spectra`, which makes it easy to plot and manipulate data and to access additional metadata.  

## Installing and loading `spectrolab`

The best way to get `spectrolab` is to install it directly from the [_github repository_](www.github.com/annakat/spectrolab). You will need the `devtools` package to do it.

```{r, eval=FALSE}
library("devtools")
install_github("annakat/spectrolab")
```

Assuming that everything went smoothly, you should be able to load `spectrolab` like any other package.

```{r}
library("spectrolab")
```

## Reading spectra and creating a `spectra` object

Assume you have a directory with several .sig files, an example can be found in the folder `Acer_example`. During your measurment campaign you might have flagged filenames of obviously bad measurements with "bad" and white reference measurements with "WR", but don't worry if you have not. We can also take care of filtering out bad and reference measurements later. First you will want to read the .sig files. 

```{r, eval=FALSE}
# Read .sig files
myfolder <- system.file("extdata", "Acer_example", package = "spectrolab")
Acer_spectra <- read.svc(myfolder, read = T, filename = T) 

# Note that this is NOT a spectra object. You can verify this by either asking what class `Acer_spectra` is or using spectrolab's `is_spectra()` function.

class(Acer_spectra)
is_spectra(Acer_spectra)

```

### Constructing a `spectra` object

The `spectra` class holds the essential information used in spectral dataset: reflectance, wavelengths, etc. The class has a bunch of requirements in terms of both format and values. For instance, relative reflectance must be between 0 and 1.

If your data is in a matrix or data.frame with the same format as `Acer_spectra` (check previous section for details), you can construct a `spectra` object by calling the `as.spectra()` function.

```{r, eval=F}
# Make a spectra object if you have a matrix in the right format
spec <- spectrolab::as.spectra(Acer_spectra)

# Did it work?
is_spectra(spec)
```

Alternativelly, you can create a `spectra` object using the more flexible `spectra()` constructor, which takes three arguments: (1) a reflectance matrix, (2) a vector of wavelengths and (3) the sample names.

```{r, eval=F}
# (1) Create a reflectance matrix.
#     In this case, by removing the sample ID column
rf <- Acer_spectra[, -1]

# Check the result
rf[1:4, 1:3]

# (2) Create a vector with wavelength labels that match
#     the reflectance matrix columns.
wl <- colnames(rf)

# Check the result
wl[1:4]

# (3) Create a vector with sample labels that match
#     the reflectance matrix rows.
#     In this case, use the first colum of spec_matrix_example
sn <- Acer_spectra[, 1] 

# Check the result
sn[1:4]

# Finally, construct the spectra object using the `spectra` constructor
spec <- spectra(reflectance = rf, wavelengths = wl, names = sn)

# And hopefully this worked fine
is_spectra(spec)
```

Now, you can explore your `spectra` using  `plot()` 

```{r, eval=F}
### Plotting
### A warning message is being displayed because in the case of raw SVC spectra we have duplicated wavelenghts at the sensor overlap regions

plot(spec)

```{r, fig.show='hold', eval=F}
plot(spec)
```


